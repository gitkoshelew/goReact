version: "3.9"

services:
    
    postgresql_database:
        image: postgres:latest
        environment:
            - POSTGRES_USER=${POSTGRES_USER}
            - POSTGRES_PASSWORD=${POSTGRES_PASSWORD}
            - POSTGRES_DB=${POSTGRES_DB}
        ports: 
            - "${POSTGRES_PORT}:5432"
        restart: always
        volumes:
            - ./init.sql:/docker-entrypoint-initdb.d/init.sql 
            - database-data:/var/lib/postgresql/data/
        networks:
            - app_net

    pgadmin:
        image: dpage/pgadmin4
        environment: 
            - PGADMIN_DEFAULT_EMAIL=${PGADMIN_DEFAULT_EMAIL}
            - PGADMIN_DEFAULT_PASSWORD=${PGADMIN_DEFAULT_PASSWORD}
        ports:
            - "${PGADMIN_PORT}:80"
        restart: always
        volumes: 
            - pgadmin:/root/.pgadmin
        networks:
            - app_net
   
    rabbitmq:
        image: rabbitmq:3-management
        ports:
            - "${RABBIT_DEMON_PORT}:4369"
            - "${RABBIT_TCP_PORT}:5672"
            - "${RABBIT_SSL_PORT}:15671"
            - "${RABBIT_HTTP_PORT_V3}:15672"
            - "${RABBIT_TOOL_PORT}:25672"
        environment:
            - RABBITMQ_SECURE_PASSWORD=yes
            - RABBITMQ_PASSWORD=my_password
        volumes:
            - rabbitmq_data:/bitnami/rabbitmq/mnesia
        networks:
            - app_net
networks:
    app_net:
        driver: bridge
volumes:
    database-data:
    pgadmin:
    rabbitmq_data:
        driver: local